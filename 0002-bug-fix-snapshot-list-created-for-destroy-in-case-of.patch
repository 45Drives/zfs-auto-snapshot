From 81f7750a66d10d118c841d84fce42d4aded7f826 Mon Sep 17 00:00:00 2001
From: Matus Kral <matuskral@me.com>
Date: Sun, 13 Jan 2013 03:14:51 +0100
Subject: [PATCH] bug fix (snapshot list created for destroy in case of
 incremental send through replication)

---
 src/zfs-auto-snapshot.sh |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/zfs-auto-snapshot.sh b/src/zfs-auto-snapshot.sh
index c8bd650..c34a87a 100755
--- a/src/zfs-auto-snapshot.sh
+++ b/src/zfs-auto-snapshot.sh
@@ -281,7 +281,7 @@ do_send ()
     local REMOTEFS="$5"
     local list_child=('')
 
-    if [ "$SENDFLAGS" = "-R" ]; then
+    if [ "$SENDFLAGS" = "-R" -a "$SENDTYPE" = "full" ]; then
         # for full send with -R, target filesystem must be without snapshots including chilren as well
         list_child=($(printf "%s\n" "${SNAPSHOTS_OLD_REM[@]}" | grep ^"$REMOTEFS" | grep @))
         if [ "$SENDTYPE" = "full" ]; then
-- 
1.7.9.6 (Apple Git-31.1)

